<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDSCH Waveform generation &mdash; NeoRadium 0.2.0 Documentation</title>
      <link rel="stylesheet" href="../../../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../../_static/neoradium.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../../../../" id="documentation_options" src="../../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../index.html" class="icon icon-home">
            NeoRadium 0.2.0
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../index.html">What is NeoRadium?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/Playground/Playground.html">Playground</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/Carrier.html">Carriers and Bandwidth Parts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/Grid.html">Resource Grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/Waveform.html">Waveform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/Modulation.html">Modulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/RefSig.html">Reference Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/PhyChannels.html">Physical Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/ChanCode.html">Channel Coding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/Antenna.html">Antenna</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/Channels.html">Channel Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../source/API/Random.html">Random Number Generator</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../index.html">NeoRadium 0.2.0</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">PDSCH Waveform generation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../_sources/html/html/source/Playground/Notebooks/CompareWithMatlab/PDSCH/PDSCH-waveform.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="PDSCH-Waveform-generation">
<h1>PDSCH Waveform generation<a class="headerlink" href="#PDSCH-Waveform-generation" title="Permalink to this heading"></a></h1>
<p>Creating PDSCH time domain waveform and comparing the results with the equivalent Matlab code “MatlabFiles/PDSCH-waveform.mlx”. <a class="reference external" href="MatlabFiles/PDSCH-waveform.html">Here</a> is the execution results of this code in Matlab.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>

<span class="kn">from</span> <span class="nn">neoradium</span> <span class="kn">import</span> <span class="n">Carrier</span><span class="p">,</span> <span class="n">PDSCH</span><span class="p">,</span> <span class="n">CdlChannel</span><span class="p">,</span> <span class="n">AntennaPanel</span><span class="p">,</span> <span class="n">LdpcEncoder</span><span class="p">,</span> <span class="n">LdpcDecoder</span><span class="p">,</span> <span class="n">Grid</span>

<span class="n">matlabFilesPath</span> <span class="o">=</span> <span class="s2">&quot;./MatlabFiles&quot;</span>
<br/></pre></div>
</div>
</div>
<section id="Carrier-Configuration">
<h2>Carrier Configuration<a class="headerlink" href="#Carrier-Configuration" title="Permalink to this heading"></a></h2>
<p>Create an instance of <code class="docutils literal notranslate"><span class="pre">Carrier</span></code> object. We use 30KHz subcarrier spacing, with a single Bandwidth Part starting at Resource Block 1, and 52 total Resource Blocks. We then call the <code class="docutils literal notranslate"><span class="pre">print</span></code> method to show the carrier information.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carrier</span> <span class="o">=</span> <span class="n">Carrier</span><span class="p">(</span><span class="n">startRb</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">numRbs</span><span class="o">=</span><span class="mi">52</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">carrier</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Carrier Properties:
  startRb: 1
  numRbs: 52
  Cell Id: 1
  Active Bandwidth Part: 0
  Bandwidth Parts: 1
  Bandwidth Part 0:
    Resource Blocks: 52 RBs starting at 1 (624 subcarriers)
    Subcarrier Spacing: 30 KHz
    CP Type: normal
    bandwidth: 18720000 Hz
    symbolsPerSlot: 14
    slotsPerSubFrame: 2
    nFFT: 1024

</pre></div></div>
</div>
</section>
<section id="PDSCH-Configuration">
<h2>PDSCH Configuration<a class="headerlink" href="#PDSCH-Configuration" title="Permalink to this heading"></a></h2>
<p>Create an instance of <code class="docutils literal notranslate"><span class="pre">PDSCH</span></code> object. We use the only Bandwidth Part of the above carrier for this PDSCH object. We then, enable the interleaving by setting the <code class="docutils literal notranslate"><span class="pre">interleavingBundleSize</span></code> argument to 2 and set number of layers to 2. The <code class="docutils literal notranslate"><span class="pre">print</span></code> function is then called to show all the information about this <code class="docutils literal notranslate"><span class="pre">PDSCH</span></code> object.</p>
<p>Note that we could also set the parameters of <code class="docutils literal notranslate"><span class="pre">DMRS</span></code> object owned by <code class="docutils literal notranslate"><span class="pre">PDSCH</span></code> by passing them when instantiating the <code class="docutils literal notranslate"><span class="pre">PDSCH</span></code> object. Here we are just using the default values.</p>
<p>Also note that the Matlab implementation does not take into account the scaling factor $ <span class="math">\beta`^{DMRS}\ *{PDSCH} $ as specified in newer versions of the standard. Our implementation by default uses the ``TS 38.214 V17.0.0 (2021-12), Table 4.1-1`</span> to get the ratio of PDSCH EPRE to DMRS EPRE ($ <span class="math">\beta`*\ {DMRS} $). To make our results match Matlab's results, we have to force the ``epreRatioDb`</span> value to zero here to ignore the table in the standard.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pdsch</span> <span class="o">=</span> <span class="n">PDSCH</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">bwps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interleavingBundleSize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">numLayers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Matlab uses NumCDMGroupsWithoutData=2 as default =&gt; otherCdmGroups=[1]</span>
<span class="n">pdsch</span><span class="o">.</span><span class="n">setDMRS</span><span class="p">(</span><span class="n">epreRatioDb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">otherCdmGroups</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">pdsch</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

PDSCH Properties:
  mappingType: A
  nID: 1
  rnti: 1
  numLayers: 2
  numCodewords: 1
  modulation: 16QAM
  portSet: [0, 1]
  symSet:   0   1   2   3   4   5   6   7   8   9  10  11  12  13
  prbSet:   0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19
           20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39
           40  41  42  43  44  45  46  47  48  49  50  51
  interleavingBundleSize: 2
  PRG Size: Wideband
  Bandwidth Part:
    Resource Blocks: 52 RBs starting at 1 (624 subcarriers)
    Subcarrier Spacing: 30 KHz
    CP Type: normal
    bandwidth: 18720000 Hz
    symbolsPerSlot: 14
    slotsPerSubFrame: 2
    nFFT: 1024
  DMRS:
    configType: 1
    nIDs: []
    scID: 0
    sameSeq: 1
    symbols: Single
    typeA1stPos: 2
    additionalPos: 0
    cdmGroups: [0, 0]
    deltaShifts: [0, 0]
    allCdmGroups: [0, 1]
    symSet: [2]
    REs (before shift): [0, 2, 4, 6, 8, 10]
    epreRatioDb: 0 (db)

</pre></div></div>
</div>
</section>
<section id="Create-a-grid-and-populate-it-with-DMRS-data">
<h2>Create a grid and populate it with DMRS data<a class="headerlink" href="#Create-a-grid-and-populate-it-with-DMRS-data" title="Permalink to this heading"></a></h2>
<p>Now we can create a resource grid (A <code class="docutils literal notranslate"><span class="pre">Grid</span></code> object) for our <code class="docutils literal notranslate"><span class="pre">PDSCH</span></code> and populate it with DMRS data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">pdsch</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span>   <span class="c1"># This creates a Grid object and populates it with the DMRS values</span>
<span class="n">grid</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(2, 14, 624)
</pre></div></div>
</div>
</section>
<section id="Comparing-DMRS-symbols">
<h2>Comparing DMRS symbols<a class="headerlink" href="#Comparing-DMRS-symbols" title="Permalink to this heading"></a></h2>
<p>Now we want to compare the DMRS symbols generated by our <code class="docutils literal notranslate"><span class="pre">PDSCH</span></code> object with Matlab’s results. Again, we first get the indexes of the DMRS symbols from the grid map. Then we get the symbols at this indexes. We then print out the first 10 DMRS symbols. We can now compare these results with the ones printed by the Matlab program <code class="docutils literal notranslate"><span class="pre">Mapping5GPhysicalChannelsAndSignalsToTheResourceGridExample.mlx</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dmrsSymbols</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getReValues</span><span class="p">(</span><span class="s2">&quot;DMRS&quot;</span><span class="p">)</span>  <span class="c1"># Get all the &quot;DMRS&quot; Resource Element values from the grid</span>

<span class="c1"># Load Matlab-generated DMRS values:</span>
<span class="n">dmrsSymbolsMatlab</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">matlabFilesPath</span> <span class="o">+</span> <span class="s1">&#39;/dmrsSymbols.mat&#39;</span><span class="p">)[</span><span class="s1">&#39;dmrsSymbols&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dmrsSymbolsMatlab</span><span class="o">-</span><span class="n">dmrsSymbols</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">1e-10</span><span class="p">,</span> <span class="s2">&quot;MISMATCH WITH MATLAB!!!&quot;</span>

<span class="c1"># Print the first 10 DMRS Symbols:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DMRS Values:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">dmrsSymbols</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matlab-Generated DMRS Values:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">dmrsSymbolsMatlab</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DMRS Values:
 [ 0.70710678-0.70710678j  0.70710678+0.70710678j  0.70710678-0.70710678j
 -0.70710678-0.70710678j -0.70710678+0.70710678j  0.70710678+0.70710678j
  0.70710678+0.70710678j  0.70710678+0.70710678j  0.70710678+0.70710678j
  0.70710678+0.70710678j]
Matlab-Generated DMRS Values:
 [ 0.70710678-0.70710678j  0.70710678+0.70710678j  0.70710678-0.70710678j
 -0.70710678-0.70710678j -0.70710678+0.70710678j  0.70710678+0.70710678j
  0.70710678+0.70710678j  0.70710678+0.70710678j  0.70710678+0.70710678j
  0.70710678+0.70710678j]
</pre></div></div>
</div>
</section>
<section id="Generate-random-bits-and-create-resource-block">
<h2>Generate random bits and create resource block<a class="headerlink" href="#Generate-random-bits-and-create-resource-block" title="Permalink to this heading"></a></h2>
<p>Here we first get the number of bits that are available in our <code class="docutils literal notranslate"><span class="pre">grid</span></code> object by calling the <code class="docutils literal notranslate"><span class="pre">getGridBitSize</span></code> method. Then we creare <code class="docutils literal notranslate"><span class="pre">numBits</span></code> random bits and feed them to the <code class="docutils literal notranslate"><span class="pre">populateGrid</span></code> method of <code class="docutils literal notranslate"><span class="pre">PDSCH</span></code>. This method scrambles, modulates, and map the modulated symbols to different layers of the grid.</p>
<p><strong>Note</strong>: To have deterministic results and be able to compare the results with matlab, we are reading the random bits from a Matlab-generated data file. You can un-remark the second line in the code below to create random bits instead of reading them from the file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numBits</span> <span class="o">=</span> <span class="n">pdsch</span><span class="o">.</span><span class="n">getBitSizes</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="c1"># bits = np.random.randint(2,size=numBits)  # Unremark this to generate random bits</span>

<span class="c1"># Loading the random bits from file to have deterministic resaults and be able to compare with matlab</span>
<span class="n">bits</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">matlabFilesPath</span> <span class="o">+</span> <span class="s1">&#39;/pdschBits.mat&#39;</span><span class="p">)[</span><span class="s1">&#39;pdschBits&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">assert</span><span class="p">(</span><span class="n">numBits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">))</span>

<span class="n">pdsch</span><span class="o">.</span><span class="n">populateGrid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">bits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Comparing-the-results-with-Matlab">
<h2>Comparing the results with Matlab<a class="headerlink" href="#Comparing-the-results-with-Matlab" title="Permalink to this heading"></a></h2>
<p>Now we want to compare the generated symbols with the Matlab’s results. We first get the data symbols from the <code class="docutils literal notranslate"><span class="pre">pdsch</span></code> object’s <code class="docutils literal notranslate"><span class="pre">getDataSymbols</span></code> method which returns all data symbols in the grid.</p>
<p>We then read all the Matlab-generated symbols (from the same random set of bits) from the file generated by the Matlab program <code class="docutils literal notranslate"><span class="pre">Mapping5GPhysicalChannelsAndSignalsToTheResourceGridExample.mlx</span></code>.</p>
<p>As you can see the results exactly matches the ones generated by Matlab.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataSymbols</span> <span class="o">=</span> <span class="n">pdsch</span><span class="o">.</span><span class="n">getDataSymbols</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

<span class="n">dataSymbolsMatlab</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">matlabFilesPath</span> <span class="o">+</span> <span class="s1">&#39;/pdschSymbols.mat&#39;</span><span class="p">)[</span><span class="s1">&#39;pdschSymbols&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dataSymbolsMatlab</span><span class="o">-</span><span class="n">dataSymbols</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">1e-10</span><span class="p">,</span> <span class="s2">&quot;MISMATCH WITH MATLAB!!!&quot;</span>

<span class="c1"># Print the first 20 Data Symbols:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Symbols:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dataSymbols</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matlab-Generated Data Symbols:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dataSymbolsMatlab</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data Symbols:
 [ 0.31622777+0.31622777j -0.9486833 -0.9486833j  -0.9486833 -0.31622777j
 -0.31622777-0.31622777j  0.31622777-0.31622777j  0.9486833 +0.9486833j
  0.9486833 +0.31622777j -0.9486833 -0.9486833j  -0.9486833 +0.9486833j
 -0.31622777+0.31622777j  0.9486833 +0.31622777j -0.9486833 -0.9486833j
  0.9486833 -0.9486833j  -0.31622777+0.9486833j   0.9486833 -0.31622777j
 -0.31622777+0.9486833j   0.31622777+0.31622777j  0.31622777+0.9486833j
 -0.9486833 -0.31622777j -0.31622777+0.31622777j]
Matlab-Generated Data Symbols:
 [ 0.31622777+0.31622777j -0.9486833 -0.9486833j  -0.9486833 -0.31622777j
 -0.31622777-0.31622777j  0.31622777-0.31622777j  0.9486833 +0.9486833j
  0.9486833 +0.31622777j -0.9486833 -0.9486833j  -0.9486833 +0.9486833j
 -0.31622777+0.31622777j  0.9486833 +0.31622777j -0.9486833 -0.9486833j
  0.9486833 -0.9486833j  -0.31622777+0.9486833j   0.9486833 -0.31622777j
 -0.31622777+0.9486833j   0.31622777+0.31622777j  0.31622777+0.9486833j
 -0.9486833 -0.31622777j -0.31622777+0.31622777j]
</pre></div></div>
</div>
</section>
<section id="Grid-Statistics">
<h2>Grid Statistics<a class="headerlink" href="#Grid-Statistics" title="Permalink to this heading"></a></h2>
<p>Now we can get some information about the resource grid statistics. The function <code class="docutils literal notranslate"><span class="pre">getStats</span></code> counts the number of resource elements allocated for data, DMRS, PTRS, reserved resources, and returns the information as a dictionary.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%-10s</span><span class="s2">: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GridSize  : 17472
NO_DATA   : 624
DMRS      : 624
PDSCH     : 16224
</pre></div></div>
</div>
</section>
<section id="Draw-resource-allocation-map">
<h2>Draw resource allocation map<a class="headerlink" href="#Draw-resource-allocation-map" title="Permalink to this heading"></a></h2>
<p>We can also draw the resource allocation map (before precoding) for different layers. For example, the following code uses the <code class="docutils literal notranslate"><span class="pre">drawMap</span></code> function to draw the resource map for the first two Resource Blocks of the grid in the first layer.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span><span class="o">.</span><span class="n">drawMap</span><span class="p">(</span><span class="n">reRange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">36</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../../../../_images/html_html_source_Playground_Notebooks_CompareWithMatlab_PDSCH_PDSCH-waveform_17_0.png" src="../../../../../../../_images/html_html_source_Playground_Notebooks_CompareWithMatlab_PDSCH_PDSCH-waveform_17_0.png" />
</div>
</div>
</section>
<section id="MIMO-Precoding">
<h2>MIMO Precoding<a class="headerlink" href="#MIMO-Precoding" title="Permalink to this heading"></a></h2>
<p>Now we can apply precoding to the our data grid. Assuming 4 transmit antenna, we create a simple precoding matrix which is based on Identity matrix. We then call the <code class="docutils literal notranslate"><span class="pre">precode</span></code> method of <code class="docutils literal notranslate"><span class="pre">grid</span></code> to get the precoded grid.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numTxAntenna</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">numTxAntenna</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numTxAntenna</span><span class="p">)</span>
<span class="c1"># Get a sub-matrix by using only the frist &#39;numLayers&#39; rows and normalize it accordingly.</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="n">pdsch</span><span class="o">.</span><span class="n">numLayers</span><span class="p">,:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pdsch</span><span class="o">.</span><span class="n">numLayers</span><span class="p">)</span>

<span class="n">w</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">w</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((2, 4),
 array([[ 0.35355339+0.j        ,  0.35355339+0.j        ,
          0.35355339+0.j        ,  0.35355339+0.j        ],
        [ 0.35355339+0.j        ,  0.        -0.35355339j,
         -0.35355339+0.j        ,  0.        +0.35355339j]]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">precodedGrid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">precode</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">precodedGrid</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((2, 14, 624), (2, 4), (4, 14, 624))
</pre></div></div>
</div>
<p>We can now compare these results with the ones printed by the Matlab program <code class="docutils literal notranslate"><span class="pre">Mapping5GPhysicalChannelsAndSignalsToTheResourceGridExample.mlx</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pdschGridMatlab</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">matlabFilesPath</span> <span class="o">+</span> <span class="s1">&#39;/pdschGrid.mat&#39;</span><span class="p">)[</span><span class="s1">&#39;pdschGrid&#39;</span><span class="p">]</span>
<span class="n">pdschGridMatlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">pdschGridMatlab</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># Matlab uses a different order</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pdschGridMatlab</span><span class="o">-</span><span class="n">precodedGrid</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">1e-10</span><span class="p">,</span> <span class="s2">&quot;MISMATCH WITH MATLAB!!!&quot;</span>

<span class="c1"># Print the first 10 Data Symbols:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Precoded Grid:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">precodedGrid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:</span><span class="mi">10</span><span class="p">],</span><span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matlab-Generated Precoded Grid:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pdschGridMatlab</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:</span><span class="mi">10</span><span class="p">],</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Precoded Grid:
 [ 0.2236+0.4472j -0.2236-0.6708j -0.2236-0.2236j  0.2236+0.j
  0.4472-0.2236j  0.4472+0.j      0.6708+0.j     -0.6708-0.4472j
 -0.2236+0.j     -0.4472+0.j    ]
Matlab-Generated Precoded Grid:
 [ 0.2236+0.4472j -0.2236-0.6708j -0.2236-0.2236j  0.2236-0.j
  0.4472-0.2236j  0.4472-0.j      0.6708+0.j     -0.6708-0.4472j
 -0.2236-0.j     -0.4472+0.j    ]
</pre></div></div>
</div>
</section>
<section id="OFDM-Modulation">
<h2>OFDM Modulation<a class="headerlink" href="#OFDM-Modulation" title="Permalink to this heading"></a></h2>
<p>Now we call the <code class="docutils literal notranslate"><span class="pre">ofdmModulate</span></code> method of our <code class="docutils literal notranslate"><span class="pre">precodedGrid</span></code> object to get the output waveform for each antenna and compare these results with the ones printed by the Matlab program <code class="docutils literal notranslate"><span class="pre">Mapping5GPhysicalChannelsAndSignalsToTheResourceGridExample.mlx</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveForm</span> <span class="o">=</span> <span class="n">precodedGrid</span><span class="o">.</span><span class="n">ofdmModulate</span><span class="p">()</span>
<span class="n">waveForm</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
<span class="n">waveformMatlab</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">matlabFilesPath</span> <span class="o">+</span> <span class="s1">&#39;/txWaveform.mat&#39;</span><span class="p">)[</span><span class="s1">&#39;txWaveform&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">waveForm</span><span class="p">[:]</span><span class="o">-</span><span class="n">waveformMatlab</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">1e-10</span><span class="p">,</span> \
    <span class="s2">&quot;MISMATCH WITH MATLAB!!! (max Diff: </span><span class="si">%f</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">waveForm</span><span class="o">-</span><span class="n">waveformMatlab</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># print the first 10 samples of the waveForm for first TX antenna</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waveform Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">waveForm</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="mi">10</span><span class="p">],</span><span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matlab-Generated Waveform Data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">waveformMatlab</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="mi">10</span><span class="p">],</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Waveform Properties:
  Number of Ports: 4
  Length: 15360

Waveform Data:
 [ 0.0053-0.0104j  0.0072+0.0016j -0.0017+0.0071j -0.0086-0.0011j
  0.0063-0.0057j  0.0191-0.0001j  0.0044+0.004j  -0.015 +0.0036j
 -0.0155+0.0084j -0.008 +0.015j ]
Matlab-Generated Waveform Data:
 [ 0.0053-0.0104j  0.0072+0.0016j -0.0017+0.0071j -0.0086-0.0011j
  0.0063-0.0057j  0.0191-0.0001j  0.0044+0.004j  -0.015 +0.0036j
 -0.0155+0.0084j -0.008 +0.015j ]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">waveForm</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Samples&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Magnitude&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Magnitude of the time-domain waveform for the first antenna&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Magnitude of the time-domain waveform for the first antenna&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../../../../_images/html_html_source_Playground_Notebooks_CompareWithMatlab_PDSCH_PDSCH-waveform_25_1.png" src="../../../../../../../_images/html_html_source_Playground_Notebooks_CompareWithMatlab_PDSCH_PDSCH-waveform_25_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, InterDigital, Inc. All Rights Reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>