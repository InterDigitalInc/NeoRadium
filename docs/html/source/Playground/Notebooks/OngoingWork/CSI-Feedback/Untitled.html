<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; NeoRadium 0.2.0 Documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/neoradium.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            NeoRadium 0.2.0
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">What is NeoRadium?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Playground.html">Playground</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/Carrier.html">Carriers and Bandwidth Parts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/Grid.html">Resource Grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/Waveform.html">Waveform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/Modulation.html">Modulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/RefSig.html">Reference Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/PhyChannels.html">Physical Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/ChanCode.html">Channel Coding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/Antenna.html">Antenna</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/Channels.html">Channel Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API/Random.html">Random Number Generator</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">NeoRadium 0.2.0</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/source/Playground/Notebooks/OngoingWork/CSI-Feedback/Untitled.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">neoradium</span> <span class="kn">import</span> <span class="n">AntennaElement</span><span class="p">,</span><span class="n">AntennaPanel</span><span class="p">,</span> <span class="n">CsiReport</span>
<span class="kn">from</span> <span class="nn">neoradium</span> <span class="kn">import</span> <span class="n">Carrier</span><span class="p">,</span> <span class="n">PDSCH</span><span class="p">,</span> <span class="n">Grid</span><span class="p">,</span> <span class="n">CsiRsConfig</span><span class="p">,</span> <span class="n">CsiRsSet</span><span class="p">,</span> <span class="n">CdlChannel</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carrier</span> <span class="o">=</span> <span class="n">Carrier</span><span class="p">(</span><span class="n">startRb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">numRbs</span><span class="o">=</span><span class="mi">52</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">bwp</span> <span class="o">=</span> <span class="n">carrier</span><span class="o">.</span><span class="n">bwps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">bwp</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
<span class="n">bwp</span><span class="o">.</span><span class="n">symbolLens</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Bandwidth Part Properties:
  Resource Blocks: 52 RBs starting at 0 (624 subcarriers)
  Subcarrier Spacing: 15 KHz
  CP Type: normal
  bandwidth: 9360000 Hz
  symbolsPerSlot: 14
  slotsPerSubFrame: 1
  nFFT: 1024

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
16384
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create 3 NZP CsiRsSet objects in the CsiRsConfig. All of them are NZP, transmitted on first symbol</span>
<span class="c1"># of the slot (Symbol 0), use 4 ports, and occupy REs (0,1,2,3), (4,5,6,7), and (8,9,10,11) correspondingly.</span>
<span class="n">csiRsConfig</span> <span class="o">=</span> <span class="n">CsiRsConfig</span><span class="p">([</span><span class="n">CsiRsSet</span><span class="p">(</span><span class="s2">&quot;NZP&quot;</span><span class="p">,</span> <span class="n">bwp</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">freqMap</span><span class="o">=</span><span class="n">fm</span><span class="p">,</span> <span class="n">numPorts</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">fm</span> <span class="ow">in</span>
                               <span class="p">[</span><span class="s2">&quot;001&quot;</span><span class="p">,</span> <span class="s2">&quot;010&quot;</span><span class="p">,</span> <span class="s2">&quot;100&quot;</span><span class="p">]])</span>  <span class="c1"># Different freq. maps for each CsiRsSet</span>
<span class="c1"># csiRsConfig.print()</span>

<span class="c1"># Create a grid and put CSI-RS info inside the grid:</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">bwp</span><span class="o">.</span><span class="n">createGrid</span><span class="p">(</span><span class="n">csiRsConfig</span><span class="o">.</span><span class="n">numPorts</span><span class="p">)</span>
<span class="n">csiRsConfig</span><span class="o">.</span><span class="n">populateGrid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

<span class="c1"># Grid Stats:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Grid Stats:&quot;</span><span class="p">)</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

<span class="c1"># Visualize the grid:</span>
<span class="c1"># grid.drawMap(ports=range(csiRsConfig.numPorts), reRange=(0,36))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Grid Stats:
  GridSize: 34944
  UNASSIGNED: 33696
  CSIRS_NZP: 1248
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an antenna panel using default antenna element template.</span>
<span class="n">txAntenna</span> <span class="o">=</span> <span class="n">AntennaPanel</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">txAntenna</span><span class="o">.</span><span class="n">showElements</span><span class="p">(</span><span class="n">zeroTicks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">txAntenna</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">txAntenna</span><span class="o">.</span><span class="n">getNumElements</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([1, 2], dtype=int16), 4)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../../_images/source_Playground_Notebooks_OngoingWork_CSI-Feedback_Untitled_3_1.png" src="../../../../../_images/source_Playground_Notebooks_OngoingWork_CSI-Feedback_Untitled_3_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a CDL-C channel model with 300ns delay spread, 4GHz carrier frequency, and 5Hz doppler shift</span>
<span class="n">channel</span> <span class="o">=</span> <span class="n">CdlChannel</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">delaySpread</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">carrierFreq</span><span class="o">=</span><span class="mf">4e9</span><span class="p">,</span> <span class="n">dopplerShift</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                     <span class="n">txAntenna</span> <span class="o">=</span> <span class="n">txAntenna</span><span class="p">,</span>
                     <span class="n">rxAntenna</span> <span class="o">=</span> <span class="n">AntennaPanel</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">),</span>       <span class="c1"># 4 RX antenna</span>
                     <span class="n">timing</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span> <span class="c1"># Nearest Neighbors interpolation (Also try: &quot;Polar&quot;, &quot;linear&quot;)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

CDL-D Channel Properties:
  delaySpread: 10 ns
  dopplerShift: 10 Hz
  carrierFreq: 4000000000.0 Hz
  normalizeGains: True
  normalizeOutput: True
  txDir: Downlink
  timing method: linear
  coherenceTime: 0.042314 (Sec.)
  ueDirAZ: 0°, 90°
  pathDelays (ns): 0.0000 0.0000 0.3500 6.1200 13.630 14.050 18.040 25.960 17.750 40.420
                   79.370 94.240 97.080 125.25
  pathPowers (db): -0.200 -13.50 -18.80 -21.00 -22.80 -17.90 -20.10 -21.90 -22.90 -27.80
                   -23.60 -24.80 -30.00 -27.70
  AODs (Degree):    0    0   89   89   89   13   13   13   35  -64  -33   53 -132   77
  AOAs (Degree): -180 -180   89   89   89  163  163  163 -137   74  128 -120   -9  -84
  ZODs (Degree):   98   98   86   86   86   98   98   98   98   88   91  104   80   86
  ZOAs (Degree):   82   82   87   87   87   79   79   79   78   74   78   87   71   73
  hasLOS: True
  Cross Pol. Power: 11 db
  angleSpreads: 5° 8° 3° 3°
  TX Antenna:
    Total Elements: 4
    spacing: 0.5𝜆, 0.5𝜆
    shape: 1 rows x 2 columns
    polarization: x
    taper: 1.0
  RX Antenna:
    Total Elements: 4
    spacing: 0.5𝜆, 0.5𝜆
    shape: 1 rows x 2 columns
    polarization: +
    taper: 1.0
  Channel Filter:
    filterDelay (samples): 7
    numTxAntenna: 4
    numPaths: 14
    pathDelays (ns): 0.0000 0.0000 0.3500 6.1200 13.630 14.050 18.040 25.960 17.750 40.420
                     79.370 94.240 97.080 125.25
    filterLen: 16
    numInterpol: 50
    normalize: True
    stopBandAtten: 80

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hActual</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">getChannelMatrix</span><span class="p">(</span><span class="n">bwp</span><span class="p">,</span> <span class="n">numSlots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">timeDomain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveForm</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">ofdmModulate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waveform Shape:&quot;</span><span class="p">,</span> <span class="n">waveForm</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Waveform Shape: (4, 16384)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maxDelay</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">getMaxDelay</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max. Channel Delay (Samples):&quot;</span><span class="p">,</span><span class="n">maxDelay</span><span class="p">)</span>
<span class="c1"># Append to the waveForm before passing it through the channel</span>
<span class="n">txWaveform</span> <span class="o">=</span> <span class="n">waveForm</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">maxDelay</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;txWaveform Shape:&quot;</span><span class="p">,</span> <span class="n">txWaveform</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Now apply the channel to the waveform</span>
<span class="n">rxWaveform</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">applyToSignal</span><span class="p">(</span><span class="n">txWaveform</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rxWaveform Shape:&quot;</span><span class="p">,</span> <span class="n">txWaveform</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Add noise: (SNR=10 dB)</span>
<span class="n">noisyWaveForm</span> <span class="o">=</span> <span class="n">rxWaveform</span><span class="o">.</span><span class="n">addNoise</span><span class="p">(</span><span class="n">snrDb</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nFFT</span><span class="o">=</span><span class="n">bwp</span><span class="o">.</span><span class="n">nFFT</span><span class="p">)</span>
<span class="n">noisyWaveForm</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Max. Channel Delay (Samples): 11
txWaveform Shape: (4, 16395)
rxWaveform Shape: (4, 16395)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(4, 16395)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can get channel delay from the channel (This is cheating because we don&#39;t know the channel)</span>
<span class="n">chOffset</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">getTimingOffset</span><span class="p">(</span><span class="n">txWaveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Channel Offset from the Channel Model:&quot;</span><span class="p">,</span> <span class="n">chOffset</span><span class="p">)</span>

<span class="c1"># Or estimate the offset using a resource grid with NZP CSI-RS and the recived signal</span>
<span class="c1"># Only use NZP resources:</span>
<span class="n">rxCsiRsConfig</span> <span class="o">=</span> <span class="n">CsiRsConfig</span><span class="p">([</span><span class="n">csiRsSet</span> <span class="k">for</span> <span class="n">csiRsSet</span> <span class="ow">in</span> <span class="n">csiRsConfig</span><span class="o">.</span><span class="n">csiRsSetList</span> <span class="k">if</span> <span class="n">csiRsSet</span><span class="o">.</span><span class="n">csiType</span><span class="o">==</span><span class="s2">&quot;NZP&quot;</span><span class="p">])</span>

<span class="n">csiRsGrid</span> <span class="o">=</span> <span class="n">bwp</span><span class="o">.</span><span class="n">createGrid</span><span class="p">(</span><span class="n">rxCsiRsConfig</span><span class="o">.</span><span class="n">numPorts</span><span class="p">)</span>
<span class="n">rxCsiRsConfig</span><span class="o">.</span><span class="n">populateGrid</span><span class="p">(</span><span class="n">csiRsGrid</span><span class="p">)</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">csiRsGrid</span><span class="o">.</span><span class="n">estimateTimingOffset</span><span class="p">(</span><span class="n">noisyWaveForm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estimated Offset:&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Channel Offset from the Channel Model: 7
Estimated Offset: 7
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now apply the offset to the received waveform</span>
<span class="n">syncedWaveForm</span> <span class="o">=</span> <span class="n">noisyWaveForm</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;syncedWaveForm Shape:&quot;</span><span class="p">,</span> <span class="n">syncedWaveForm</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
syncedWaveForm Shape: (4, 16388)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rxGrid</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">ofdmDemodulate</span><span class="p">(</span><span class="n">bwp</span><span class="p">,</span> <span class="n">syncedWaveForm</span><span class="p">)</span>
<span class="n">rxGrid</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(4, 14, 624)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Least Squares Channel Estimation</span>
<span class="n">hEst</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">rxGrid</span><span class="o">.</span><span class="n">estimateChannelLS</span><span class="p">(</span><span class="n">rxCsiRsConfig</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
<span class="n">hEst</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">hActual</span><span class="o">.</span><span class="n">shape</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((14, 624, 4, 4), (14, 624, 4, 4))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min Absolute Error:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hActual</span><span class="o">-</span><span class="n">hEst</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max Absolute Error:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hActual</span><span class="o">-</span><span class="n">hEst</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean Absolute Error:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hActual</span><span class="o">-</span><span class="n">hEst</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hActual</span><span class="o">-</span><span class="n">hEst</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="c1"># Print symbol values for the first subcarrier for the first pair of antennas</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Actual Channel:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">hActual</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estimated Channel:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">hEst</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Min Absolute Error: 4.152077454384459e-06
Max Absolute Error: 0.004140206755751211
Mean Absolute Error: 0.0012053535933496415
MSE: 1.8658583014719393e-06
Actual Channel:
 [0.06177877-0.00491705j 0.06175917-0.00506486j 0.06173923-0.00521265j
 0.06171894-0.0053604j  0.0616983 -0.00550813j 0.06167732-0.00565583j
 0.061656  -0.00580349j 0.06163403-0.00595314j 0.06161201-0.00610074j
 0.06158965-0.00624831j 0.06156694-0.00639584j 0.06154389-0.00654333j
 0.06152049-0.00669079j 0.06149675-0.00683821j]
Estimated Channel:
 [0.06072263-0.00625106j 0.06072263-0.00625106j 0.06072263-0.00625106j
 0.06072263-0.00625106j 0.06072263-0.00625106j 0.06072263-0.00625106j
 0.06072263-0.00625106j 0.06072263-0.00625106j 0.06072263-0.00625106j
 0.06072263-0.00625106j 0.06072263-0.00625106j 0.06072263-0.00625106j
 0.06072263-0.00625106j 0.06072263-0.00625106j]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idxes</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getReIndexes</span><span class="p">(</span><span class="s2">&quot;CSIRS_NZP&quot;</span><span class="p">)</span>
<span class="n">p1Idxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">idxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">idxes</span> <span class="o">=</span> <span class="p">(</span><span class="n">idxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">p1Idxes</span><span class="p">],</span> <span class="n">idxes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">p1Idxes</span><span class="p">],</span> <span class="n">idxes</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">p1Idxes</span><span class="p">])</span> <span class="c1"># indexes in 1st port</span>
<span class="n">idxes</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0]),
 array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0]),
 array([  0,   1,   4,   5,   8,   9,  12,  13,  16,  17,  20,  21,  24,
         25,  28,  29,  32,  33,  36,  37,  40,  41,  44,  45,  48,  49,
         52,  53,  56,  57,  60,  61,  64,  65,  68,  69,  72,  73,  76,
         77,  80,  81,  84,  85,  88,  89,  92,  93,  96,  97, 100, 101,
        104, 105, 108, 109, 112, 113, 116, 117, 120, 121, 124, 125, 128,
        129, 132, 133, 136, 137, 140, 141, 144, 145, 148, 149, 152, 153,
        156, 157, 160, 161, 164, 165, 168, 169, 172, 173, 176, 177, 180,
        181, 184, 185, 188, 189, 192, 193, 196, 197, 200, 201, 204, 205,
        208, 209, 212, 213, 216, 217, 220, 221, 224, 225, 228, 229, 232,
        233, 236, 237, 240, 241, 244, 245, 248, 249, 252, 253, 256, 257,
        260, 261, 264, 265, 268, 269, 272, 273, 276, 277, 280, 281, 284,
        285, 288, 289, 292, 293, 296, 297, 300, 301, 304, 305, 308, 309,
        312, 313, 316, 317, 320, 321, 324, 325, 328, 329, 332, 333, 336,
        337, 340, 341, 344, 345, 348, 349, 352, 353, 356, 357, 360, 361,
        364, 365, 368, 369, 372, 373, 376, 377, 380, 381, 384, 385, 388,
        389, 392, 393, 396, 397, 400, 401, 404, 405, 408, 409, 412, 413,
        416, 417, 420, 421, 424, 425, 428, 429, 432, 433, 436, 437, 440,
        441, 444, 445, 448, 449, 452, 453, 456, 457, 460, 461, 464, 465,
        468, 469, 472, 473, 476, 477, 480, 481, 484, 485, 488, 489, 492,
        493, 496, 497, 500, 501, 504, 505, 508, 509, 512, 513, 516, 517,
        520, 521, 524, 525, 528, 529, 532, 533, 536, 537, 540, 541, 544,
        545, 548, 549, 552, 553, 556, 557, 560, 561, 564, 565, 568, 569,
        572, 573, 576, 577, 580, 581, 584, 585, 588, 589, 592, 593, 596,
        597, 600, 601, 604, 605, 608, 609, 612, 613, 616, 617, 620, 621]))
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csiReport</span> <span class="o">=</span> <span class="n">CsiReport</span><span class="p">(</span><span class="n">bwp</span><span class="o">=</span><span class="n">bwp</span><span class="p">,</span> <span class="n">csiRsConfig</span><span class="o">=</span><span class="n">rxCsiRsConfig</span><span class="p">,</span> <span class="n">codebookType</span><span class="o">=</span><span class="s2">&quot;Type1SP&quot;</span><span class="p">,</span>
                      <span class="n">codebookMode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">txAntenna</span><span class="o">=</span><span class="n">txAntenna</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span> <span class="o">=</span> <span class="n">csiReport</span>

<span class="k">def</span> <span class="nf">removeNeighbors</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="c1"># idx is the 2D indexes (port removed). It is a tuple (x, y).</span>
    <span class="c1"># We have a CSI-RS RE at symbol x[i], and subcarrier y[i].</span>
    <span class="c1"># We want to use only one RE for a set of Neighboring REs (i.e. the ones in the same CDM group)</span>
    <span class="n">bmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">bmp</span><span class="p">[(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bmp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">bmp</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bmp</span><span class="p">[</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">-</span><span class="n">bmp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">!=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bmp</span><span class="p">[</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bmp</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">csiRsGrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bwp</span><span class="o">.</span><span class="n">createGrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numPorts</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">csiRsConfig</span><span class="o">.</span><span class="n">populateGrid</span><span class="p">(</span><span class="n">csiRsGrid</span><span class="p">)</span>
<span class="n">csiRsIndexes</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getReIndexes</span><span class="p">(</span><span class="s2">&quot;CSIRS_NZP&quot;</span><span class="p">)</span>   <span class="c1"># A tuple of (ports, symbols, subcarriers)</span>
<span class="n">p0Idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">csiRsIndexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>         <span class="c1"># Indexes in the csiRsIndexes corresponding to port 0</span>
<span class="n">csiRsIndexesP0</span> <span class="o">=</span> <span class="p">(</span><span class="n">idxes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">p1Idxes</span><span class="p">],</span> <span class="n">idxes</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">p1Idxes</span><span class="p">])</span>     <span class="c1"># A tuple of (symbols, subcarriers) corresponding to port 0</span>
<span class="n">csiRsIndexesP0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0]),
 array([  0,   1,   4,   5,   8,   9,  12,  13,  16,  17,  20,  21,  24,
         25,  28,  29,  32,  33,  36,  37,  40,  41,  44,  45,  48,  49,
         52,  53,  56,  57,  60,  61,  64,  65,  68,  69,  72,  73,  76,
         77,  80,  81,  84,  85,  88,  89,  92,  93,  96,  97, 100, 101,
        104, 105, 108, 109, 112, 113, 116, 117, 120, 121, 124, 125, 128,
        129, 132, 133, 136, 137, 140, 141, 144, 145, 148, 149, 152, 153,
        156, 157, 160, 161, 164, 165, 168, 169, 172, 173, 176, 177, 180,
        181, 184, 185, 188, 189, 192, 193, 196, 197, 200, 201, 204, 205,
        208, 209, 212, 213, 216, 217, 220, 221, 224, 225, 228, 229, 232,
        233, 236, 237, 240, 241, 244, 245, 248, 249, 252, 253, 256, 257,
        260, 261, 264, 265, 268, 269, 272, 273, 276, 277, 280, 281, 284,
        285, 288, 289, 292, 293, 296, 297, 300, 301, 304, 305, 308, 309,
        312, 313, 316, 317, 320, 321, 324, 325, 328, 329, 332, 333, 336,
        337, 340, 341, 344, 345, 348, 349, 352, 353, 356, 357, 360, 361,
        364, 365, 368, 369, 372, 373, 376, 377, 380, 381, 384, 385, 388,
        389, 392, 393, 396, 397, 400, 401, 404, 405, 408, 409, 412, 413,
        416, 417, 420, 421, 424, 425, 428, 429, 432, 433, 436, 437, 440,
        441, 444, 445, 448, 449, 452, 453, 456, 457, 460, 461, 464, 465,
        468, 469, 472, 473, 476, 477, 480, 481, 484, 485, 488, 489, 492,
        493, 496, 497, 500, 501, 504, 505, 508, 509, 512, 513, 516, 517,
        520, 521, 524, 525, 528, 529, 532, 533, 536, 537, 540, 541, 544,
        545, 548, 549, 552, 553, 556, 557, 560, 561, 564, 565, 568, 569,
        572, 573, 576, 577, 580, 581, 584, 585, 588, 589, 592, 593, 596,
        597, 600, 601, 604, 605, 608, 609, 612, 613, 616, 617, 620, 621]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csiRsIndexesP0</span> <span class="o">=</span> <span class="n">removeNeighbors</span><span class="p">(</span><span class="n">csiRsIndexesP0</span><span class="p">)</span>
<span class="n">csiRsIndexesP0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0]),
 array([  0,   4,   8,  12,  16,  20,  24,  28,  32,  36,  40,  44,  48,
         52,  56,  60,  64,  68,  72,  76,  80,  84,  88,  92,  96, 100,
        104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152,
        156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204,
        208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 256,
        260, 264, 268, 272, 276, 280, 284, 288, 292, 296, 300, 304, 308,
        312, 316, 320, 324, 328, 332, 336, 340, 344, 348, 352, 356, 360,
        364, 368, 372, 376, 380, 384, 388, 392, 396, 400, 404, 408, 412,
        416, 420, 424, 428, 432, 436, 440, 444, 448, 452, 456, 460, 464,
        468, 472, 476, 480, 484, 488, 492, 496, 500, 504, 508, 512, 516,
        520, 524, 528, 532, 536, 540, 544, 548, 552, 556, 560, 564, 568,
        572, 576, 580, 584, 588, 592, 596, 600, 604, 608, 612, 616, 620]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hAtCsiRs</span> <span class="o">=</span> <span class="n">hActual</span><span class="p">[</span><span class="n">csiRsIndexesP0</span><span class="p">]</span>
<span class="n">hAtCsiRs</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(156, 4, 4)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csiRsIndexesP0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0]),
 array([  0,   4,   8,  12,  16,  20,  24,  28,  32,  36,  40,  44,  48,
         52,  56,  60,  64,  68,  72,  76,  80,  84,  88,  92,  96, 100,
        104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152,
        156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204,
        208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 256,
        260, 264, 268, 272, 276, 280, 284, 288, 292, 296, 300, 304, 308,
        312, 316, 320, 324, 328, 332, 336, 340, 344, 348, 352, 356, 360,
        364, 368, 372, 376, 380, 384, 388, 392, 396, 400, 404, 408, 412,
        416, 420, 424, 428, 432, 436, 440, 444, 448, 452, 456, 460, 464,
        468, 472, 476, 480, 484, 488, 492, 496, 500, 504, 508, 512, 516,
        520, 524, 528, 532, 536, 540, 544, 548, 552, 556, 560, 564, 568,
        572, 576, 580, 584, 588, 592, 596, 600, 604, 608, 612, 616, 620]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">csiRsIndexesP0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">96</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">csiRsIndexesP0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">48</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">idx</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">csiRsIndexesP0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">],</span> <span class="n">csiRsIndexesP0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),
 array([52, 56, 60, 64, 68, 72, 76, 80, 84, 88, 92]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indexes</span><span class="p">,</span> <span class="n">codebook</span> <span class="o">=</span> <span class="n">csiReport</span><span class="o">.</span><span class="n">getCodebook</span><span class="p">(</span><span class="n">numLayers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">codebook</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((64, 4, 1), 64)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indexes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[[0, 0], 0],
 [[0, 0], 1],
 [[0, 0], 2],
 [[0, 0], 3],
 [[0, 0], 4],
 [[0, 0], 5],
 [[0, 0], 6],
 [[0, 0], 7],
 [[0, 0], 8],
 [[0, 0], 9],
 [[0, 0], 10],
 [[0, 0], 11],
 [[0, 0], 12],
 [[0, 0], 13],
 [[0, 0], 14],
 [[0, 0], 15],
 [[1, 0], 0],
 [[1, 0], 1],
 [[1, 0], 2],
 [[1, 0], 3],
 [[1, 0], 4],
 [[1, 0], 5],
 [[1, 0], 6],
 [[1, 0], 7],
 [[1, 0], 8],
 [[1, 0], 9],
 [[1, 0], 10],
 [[1, 0], 11],
 [[1, 0], 12],
 [[1, 0], 13],
 [[1, 0], 14],
 [[1, 0], 15],
 [[2, 0], 0],
 [[2, 0], 1],
 [[2, 0], 2],
 [[2, 0], 3],
 [[2, 0], 4],
 [[2, 0], 5],
 [[2, 0], 6],
 [[2, 0], 7],
 [[2, 0], 8],
 [[2, 0], 9],
 [[2, 0], 10],
 [[2, 0], 11],
 [[2, 0], 12],
 [[2, 0], 13],
 [[2, 0], 14],
 [[2, 0], 15],
 [[3, 0], 0],
 [[3, 0], 1],
 [[3, 0], 2],
 [[3, 0], 3],
 [[3, 0], 4],
 [[3, 0], 5],
 [[3, 0], 6],
 [[3, 0], 7],
 [[3, 0], 8],
 [[3, 0], 9],
 [[3, 0], 10],
 [[3, 0], 11],
 [[3, 0], 12],
 [[3, 0], 13],
 [[3, 0], 14],
 [[3, 0], 15]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">codebook</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">4</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1 1
 [[0.5+0.j]
 [0.5+0.j]
 [0.5+0.j]
 [0.5+0.j]]

2 1
 [[0.5+0.j ]
 [0.5+0.j ]
 [0. +0.5j]
 [0. +0.5j]]

3 1
 [[ 0.5+0.j]
 [ 0.5+0.j]
 [-0.5+0.j]
 [-0.5+0.j]]

4 1
 [[ 0.5+0.j ]
 [ 0.5+0.j ]
 [-0. -0.5j]
 [-0. -0.5j]]

5 1
 [[0.5   +0.j    ]
 [0.3536+0.3536j]
 [0.5   +0.j    ]
 [0.3536+0.3536j]]

6 1
 [[ 0.5   +0.j    ]
 [ 0.3536+0.3536j]
 [ 0.    +0.5j   ]
 [-0.3536+0.3536j]]

7 1
 [[ 0.5   +0.j    ]
 [ 0.3536+0.3536j]
 [-0.5   +0.j    ]
 [-0.3536-0.3536j]]

8 1
 [[ 0.5   +0.j    ]
 [ 0.3536+0.3536j]
 [-0.    -0.5j   ]
 [ 0.3536-0.3536j]]

9 1
 [[0.5+0.j ]
 [0. +0.5j]
 [0.5+0.j ]
 [0. +0.5j]]

10 1
 [[ 0.5+0.j ]
 [ 0. +0.5j]
 [ 0. +0.5j]
 [-0.5+0.j ]]

11 1
 [[ 0.5+0.j ]
 [ 0. +0.5j]
 [-0.5+0.j ]
 [-0. -0.5j]]

12 1
 [[ 0.5+0.j ]
 [ 0. +0.5j]
 [-0. -0.5j]
 [ 0.5-0.j ]]

13 1
 [[ 0.5   +0.j    ]
 [-0.3536+0.3536j]
 [ 0.5   +0.j    ]
 [-0.3536+0.3536j]]

14 1
 [[ 0.5   +0.j    ]
 [-0.3536+0.3536j]
 [ 0.    +0.5j   ]
 [-0.3536-0.3536j]]

15 1
 [[ 0.5   +0.j    ]
 [-0.3536+0.3536j]
 [-0.5   +0.j    ]
 [ 0.3536-0.3536j]]

16 1
 [[ 0.5   +0.j    ]
 [-0.3536+0.3536j]
 [-0.    -0.5j   ]
 [ 0.3536+0.3536j]]

1 2
 [[0.5+0.j ]
 [0. +0.5j]
 [0.5+0.j ]
 [0. +0.5j]]

2 2
 [[ 0.5+0.j ]
 [ 0. +0.5j]
 [ 0. +0.5j]
 [-0.5+0.j ]]

3 2
 [[ 0.5+0.j ]
 [ 0. +0.5j]
 [-0.5+0.j ]
 [-0. -0.5j]]

4 2
 [[ 0.5+0.j ]
 [ 0. +0.5j]
 [-0. -0.5j]
 [ 0.5-0.j ]]

5 2
 [[ 0.5   +0.j    ]
 [-0.3536+0.3536j]
 [ 0.5   +0.j    ]
 [-0.3536+0.3536j]]

6 2
 [[ 0.5   +0.j    ]
 [-0.3536+0.3536j]
 [ 0.    +0.5j   ]
 [-0.3536-0.3536j]]

7 2
 [[ 0.5   +0.j    ]
 [-0.3536+0.3536j]
 [-0.5   +0.j    ]
 [ 0.3536-0.3536j]]

8 2
 [[ 0.5   +0.j    ]
 [-0.3536+0.3536j]
 [-0.    -0.5j   ]
 [ 0.3536+0.3536j]]

9 2
 [[ 0.5+0.j]
 [-0.5+0.j]
 [ 0.5+0.j]
 [-0.5+0.j]]

10 2
 [[ 0.5+0.j ]
 [-0.5+0.j ]
 [ 0. +0.5j]
 [-0. -0.5j]]

11 2
 [[ 0.5+0.j]
 [-0.5+0.j]
 [-0.5+0.j]
 [ 0.5-0.j]]

12 2
 [[ 0.5+0.j ]
 [-0.5+0.j ]
 [-0. -0.5j]
 [ 0. +0.5j]]

13 2
 [[ 0.5   +0.j    ]
 [-0.3536-0.3536j]
 [ 0.5   +0.j    ]
 [-0.3536-0.3536j]]

14 2
 [[ 0.5   +0.j    ]
 [-0.3536-0.3536j]
 [ 0.    +0.5j   ]
 [ 0.3536-0.3536j]]

15 2
 [[ 0.5   +0.j    ]
 [-0.3536-0.3536j]
 [-0.5   +0.j    ]
 [ 0.3536+0.3536j]]

16 2
 [[ 0.5   +0.j    ]
 [-0.3536-0.3536j]
 [-0.    -0.5j   ]
 [-0.3536+0.3536j]]

1 3
 [[ 0.5+0.j]
 [-0.5+0.j]
 [ 0.5+0.j]
 [-0.5+0.j]]

2 3
 [[ 0.5+0.j ]
 [-0.5+0.j ]
 [ 0. +0.5j]
 [-0. -0.5j]]

3 3
 [[ 0.5+0.j]
 [-0.5+0.j]
 [-0.5+0.j]
 [ 0.5-0.j]]

4 3
 [[ 0.5+0.j ]
 [-0.5+0.j ]
 [-0. -0.5j]
 [ 0. +0.5j]]

5 3
 [[ 0.5   +0.j    ]
 [-0.3536-0.3536j]
 [ 0.5   +0.j    ]
 [-0.3536-0.3536j]]

6 3
 [[ 0.5   +0.j    ]
 [-0.3536-0.3536j]
 [ 0.    +0.5j   ]
 [ 0.3536-0.3536j]]

7 3
 [[ 0.5   +0.j    ]
 [-0.3536-0.3536j]
 [-0.5   +0.j    ]
 [ 0.3536+0.3536j]]

8 3
 [[ 0.5   +0.j    ]
 [-0.3536-0.3536j]
 [-0.    -0.5j   ]
 [-0.3536+0.3536j]]

9 3
 [[ 0.5+0.j ]
 [-0. -0.5j]
 [ 0.5+0.j ]
 [-0. -0.5j]]

10 3
 [[ 0.5+0.j ]
 [-0. -0.5j]
 [ 0. +0.5j]
 [ 0.5-0.j ]]

11 3
 [[ 0.5+0.j ]
 [-0. -0.5j]
 [-0.5+0.j ]
 [ 0. +0.5j]]

12 3
 [[ 0.5+0.j ]
 [-0. -0.5j]
 [-0. -0.5j]
 [-0.5+0.j ]]

13 3
 [[0.5   +0.j    ]
 [0.3536-0.3536j]
 [0.5   +0.j    ]
 [0.3536-0.3536j]]

14 3
 [[0.5   +0.j    ]
 [0.3536-0.3536j]
 [0.    +0.5j   ]
 [0.3536+0.3536j]]

15 3
 [[ 0.5   +0.j    ]
 [ 0.3536-0.3536j]
 [-0.5   +0.j    ]
 [-0.3536+0.3536j]]

16 3
 [[ 0.5   +0.j    ]
 [ 0.3536-0.3536j]
 [-0.    -0.5j   ]
 [-0.3536-0.3536j]]

1 4
 [[ 0.5+0.j ]
 [-0. -0.5j]
 [ 0.5+0.j ]
 [-0. -0.5j]]

2 4
 [[ 0.5+0.j ]
 [-0. -0.5j]
 [ 0. +0.5j]
 [ 0.5-0.j ]]

3 4
 [[ 0.5+0.j ]
 [-0. -0.5j]
 [-0.5+0.j ]
 [ 0. +0.5j]]

4 4
 [[ 0.5+0.j ]
 [-0. -0.5j]
 [-0. -0.5j]
 [-0.5+0.j ]]

5 4
 [[0.5   +0.j    ]
 [0.3536-0.3536j]
 [0.5   +0.j    ]
 [0.3536-0.3536j]]

6 4
 [[0.5   +0.j    ]
 [0.3536-0.3536j]
 [0.    +0.5j   ]
 [0.3536+0.3536j]]

7 4
 [[ 0.5   +0.j    ]
 [ 0.3536-0.3536j]
 [-0.5   +0.j    ]
 [-0.3536+0.3536j]]

8 4
 [[ 0.5   +0.j    ]
 [ 0.3536-0.3536j]
 [-0.    -0.5j   ]
 [-0.3536-0.3536j]]

9 4
 [[0.5+0.j]
 [0.5-0.j]
 [0.5+0.j]
 [0.5-0.j]]

10 4
 [[0.5+0.j ]
 [0.5-0.j ]
 [0. +0.5j]
 [0. +0.5j]]

11 4
 [[ 0.5+0.j]
 [ 0.5-0.j]
 [-0.5+0.j]
 [-0.5+0.j]]

12 4
 [[ 0.5+0.j ]
 [ 0.5-0.j ]
 [-0. -0.5j]
 [-0. -0.5j]]

13 4
 [[0.5   +0.j    ]
 [0.3536+0.3536j]
 [0.5   +0.j    ]
 [0.3536+0.3536j]]

14 4
 [[ 0.5   +0.j    ]
 [ 0.3536+0.3536j]
 [ 0.    +0.5j   ]
 [-0.3536+0.3536j]]

15 4
 [[ 0.5   +0.j    ]
 [ 0.3536+0.3536j]
 [-0.5   +0.j    ]
 [-0.3536-0.3536j]]

16 4
 [[ 0.5   +0.j    ]
 [ 0.3536+0.3536j]
 [-0.    -0.5j   ]
 [ 0.3536-0.3536j]]

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">codebookType</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Type1SP&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">codebookMode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">numLayers</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>
            <span class="n">csiReport</span> <span class="o">=</span> <span class="n">CsiReport</span><span class="p">(</span><span class="n">bwp</span><span class="o">=</span><span class="n">bwp</span><span class="p">,</span> <span class="n">codebookType</span><span class="o">=</span><span class="n">codebookType</span><span class="p">,</span> <span class="n">codebookMode</span><span class="o">=</span><span class="n">codebookMode</span><span class="p">,</span> <span class="n">txAntenna</span><span class="o">=</span><span class="n">txAntenna</span><span class="p">)</span>
            <span class="n">indexes</span><span class="p">,</span> <span class="n">codebook</span> <span class="o">=</span> <span class="n">csiReport</span><span class="o">.</span><span class="n">getCodebook</span><span class="p">(</span><span class="n">numLayers</span><span class="o">=</span><span class="n">numLayers</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">codebookType</span><span class="p">,</span> <span class="s2">&quot;codebookMode:&quot;</span><span class="p">,</span> <span class="n">codebookMode</span><span class="p">,</span> <span class="s2">&quot;numLayers:&quot;</span><span class="p">,</span> <span class="n">numLayers</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">),</span> <span class="s2">&quot;indexes, codebook Shape:&quot;</span><span class="p">,</span> <span class="n">codebook</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Type1SP codebookMode: 1 numLayers: 1
32 indexes, codebook Shape: (32, 4, 1)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[20], line 5</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> numLayers <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> [<span style="color: rgb(98,98,98)">1</span>,<span style="color: rgb(98,98,98)">2</span>,<span style="color: rgb(98,98,98)">3</span>,<span style="color: rgb(98,98,98)">4</span>]:
<span class="ansi-green-intense-fg ansi-bold">      4</span>     csiReport <span style="color: rgb(98,98,98)">=</span> CsiReport(bwp<span style="color: rgb(98,98,98)">=</span>bwp, codebookType<span style="color: rgb(98,98,98)">=</span>codebookType, codebookMode<span style="color: rgb(98,98,98)">=</span>codebookMode, txAntenna<span style="color: rgb(98,98,98)">=</span>txAntenna)
<span class="ansi-green-fg">----&gt; 5</span>     indexes, codebook <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">csiReport</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">getCodebook</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">numLayers</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">numLayers</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span style="color: rgb(0,135,0)">print</span>(codebookType, <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">codebookMode:</span><span style="color: rgb(175,0,0)">&#34;</span>, codebookMode, <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">numLayers:</span><span style="color: rgb(175,0,0)">&#34;</span>, numLayers)
<span class="ansi-green-intense-fg ansi-bold">      7</span>     <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(0,135,0)">len</span>(indexes), <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">indexes, codebook Shape:</span><span style="color: rgb(175,0,0)">&#34;</span>, codebook<span style="color: rgb(98,98,98)">.</span>shape)

File <span class="ansi-green-fg">~/code/Fireball/OpenSource/onGithub/Tests/Wireless/NewProject/OnGit/neoradium/neoradium/csifeedback.py:219</span>, in <span class="ansi-cyan-fg">CsiReport.getCodebook</span><span class="ansi-blue-fg">(self, numLayers)</span>
<span class="ansi-green-intense-fg ansi-bold">    217</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> i1,i2 <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>type1SpIndexes(numLayers):
<span class="ansi-green-intense-fg ansi-bold">    218</span>         indexes <span style="color: rgb(98,98,98)">+</span><span style="color: rgb(98,98,98)">=</span> [ [i1,i2] ]
<span class="ansi-green-fg">--&gt; 219</span>         codebook <span style="color: rgb(98,98,98)">+</span><span style="color: rgb(98,98,98)">=</span> [ <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">getType1SpPrecoder</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">numLayers</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">i1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">i2</span><span class="ansi-yellow-bg">)</span> ]
<span class="ansi-green-intense-fg ansi-bold">    220</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> indexes, np<span style="color: rgb(98,98,98)">.</span>array(codebook)
<span class="ansi-green-intense-fg ansi-bold">    222</span> <span class="ansi-bold" style="color: rgb(0,135,0)">assert</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>codebookType <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Type1MP</span><span style="color: rgb(175,0,0)">&#39;</span>

File <span class="ansi-green-fg">~/code/Fireball/OpenSource/onGithub/Tests/Wireless/NewProject/OnGit/neoradium/neoradium/csifeedback.py:415</span>, in <span class="ansi-cyan-fg">CsiReport.getType1SpPrecoder</span><span class="ansi-blue-fg">(self, numLayers, i1, i2)</span>
<span class="ansi-green-intense-fg ansi-bold">    412</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> np<span style="color: rgb(98,98,98)">.</span>concatenate([vlm, phi<span style="color: rgb(98,98,98)">*</span>vlm])<span style="color: rgb(98,98,98)">/</span>np<span style="color: rgb(98,98,98)">.</span>sqrt(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>numPorts)
<span class="ansi-green-intense-fg ansi-bold">    414</span> <span style="color: rgb(95,135,135)"># ----------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="ansi-green-fg">--&gt; 415</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">numLayers</span> <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(98,98,98)">2</span>:
<span class="ansi-green-intense-fg ansi-bold">    416</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> ( (<span style="color: rgb(0,135,0)">type</span>(i1) <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> [<span style="color: rgb(0,135,0)">tuple</span>, <span style="color: rgb(0,135,0)">list</span>]) <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> (<span style="color: rgb(0,135,0)">len</span>(i1)<span style="color: rgb(98,98,98)">==</span><span style="color: rgb(98,98,98)">3</span>) ):    <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>( <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">i1</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)"> must be a tuple or list of length three!</span><span style="color: rgb(175,0,0)">&#34;</span> )
<span class="ansi-green-intense-fg ansi-bold">    417</span>     i11,i12,i13 <span style="color: rgb(98,98,98)">=</span> i1

<span class="ansi-red-fg">AttributeError</span>: &#39;CsiReport&#39; object has no attribute &#39;numLayers&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csiReport</span> <span class="o">=</span> <span class="n">CsiReport</span><span class="p">(</span><span class="n">codebookType</span><span class="o">=</span><span class="s2">&quot;Type1SP&quot;</span><span class="p">,</span> <span class="n">codebookMode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n2</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[19], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> csiReport <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">CsiReport</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">codebookType</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">Type1SP</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">codebookMode</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">n1</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">n2</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/code/Fireball/OpenSource/onGithub/Tests/Wireless/NewProject/OnGit/neoradium/neoradium/csifeedback.py:181</span>, in <span class="ansi-cyan-fg">CsiReport.__init__</span><span class="ansi-blue-fg">(self, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    179</span> <span style="color: rgb(95,135,135)"># subbandSize: See 3GPP TS 38.214, Table 5.2.1.4-2</span>
<span class="ansi-green-intense-fg ansi-bold">    180</span> subbandSizeValues <span style="color: rgb(98,98,98)">=</span> [<span style="color: rgb(98,98,98)">0</span>]
<span class="ansi-green-fg">--&gt; 181</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">bwp</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">numRbs</span><span style="color: rgb(98,98,98)">&lt;</span><span style="color: rgb(98,98,98)">24</span>:      subbandSizeValues <span style="color: rgb(98,98,98)">=</span> [<span style="color: rgb(98,98,98)">0</span>]      <span style="color: rgb(95,135,135)"># No subbands if BWP size is less than 24</span>
<span class="ansi-green-intense-fg ansi-bold">    182</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>bwp<span style="color: rgb(98,98,98)">.</span>numRbs<span style="color: rgb(98,98,98)">&lt;</span><span style="color: rgb(98,98,98)">73</span>:    subbandSizeValues <span style="color: rgb(98,98,98)">=</span> [<span style="color: rgb(98,98,98)">4</span>, <span style="color: rgb(98,98,98)">8</span>]
<span class="ansi-green-intense-fg ansi-bold">    183</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>bwp<span style="color: rgb(98,98,98)">.</span>numRbs<span style="color: rgb(98,98,98)">&lt;</span><span style="color: rgb(98,98,98)">145</span>:   subbandSizeValues <span style="color: rgb(98,98,98)">=</span> [<span style="color: rgb(98,98,98)">8</span>, <span style="color: rgb(98,98,98)">16</span>]

<span class="ansi-red-fg">AttributeError</span>: &#39;NoneType&#39; object has no attribute &#39;numRbs&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cb</span> <span class="o">=</span> <span class="n">csiReport</span><span class="o">.</span><span class="n">getType1SpPrecoder</span><span class="p">(</span><span class="n">numLayers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">i1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cb</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((2, 1),
 array([[0.7071+0.j],
        [0.7071+0.j]]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">csiReport</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">csiReport</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">csiReport</span><span class="o">.</span><span class="n">numPorts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0.5+0.j],
       [0.5+0.j],
       [0.5+0.j],
       [0.5+0.j]])
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, InterDigital, Inc. All Rights Reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>